* uFluidics Counter Project
This repository is the code for the EE4400 uFluidics Counting Project,
for the dsPIC33fj128gp802. To build, make sure MPLAB X and XC16 are
installed, then run 'make'.

** Circuit
   - Chip: dsPIC33fj128gp802 - dip variant
   - ADC connection
     - Pin AN9, package pin 28
   - SPI:
     - SCK: RP12, pin 23
     - MOSI: RP11, pin 22
     - MISO: RP13, pin 24
     - SS_N: RP14, pin 25
   - Passives:
     - 100nF caps: pin 28, pin 20, pin 13
     - 10uF cap: pin 20
       - *This component is REQUIRED to program the chip*
     - 1k pullup on MCLR_N (pin 1)
   - Supply Voltage
     - 3.25V

** Specifications
   - Analog input signal 200mv pk, unknown waveform
   - Amplified to some level 700mv pk?
   - Sampled at 10kHz
   - Cells counted somehow

** TODO List [40%]
   - [-] Test the features of the chip [83%]
     - [X] ADC
     - [X] UART
     - [X] SPI
     - [-] DMA [1/2]
       - [ ] UART
       - [X] ADC
     - [X] 80MHz Clock
     - [X] 10kHz timer
   - [X] Create A mini oscilloscope
   - [X] Collect simulated waveform
     - Waveforms are in data/
   - [-] Analyze simulated data in matlab, determine best counting method
     - [X] FFT amplitude
     - [-] Correlation + threshold
       - [X] Correlation
       - [ ] Create better correlation waveform. Currently just a sine wave, but
	     needs to approximate the triangle-y shape of the actual signal
       - [ ] Proper threshold amount
   - [ ] Program above solution on dsp
     - Collect 256 samples from ADC
     - Append them to previous 256 samples
     - Convert samples to complex, pad with 0s to go to 1024 samples
     - Run FFT
     - multiply with FFT of the target waveform (stored in program memory)
     - run IFFT
     - Threshold + count
     
** Collected data
[[./data/data2.png]]

A large nail dropped through a straw, sampled at 5kHz

[[./data/data4.png]]

A small piece of nail dropped through a straw, 5kHz

* Characterization
** With Two cubic magnets
   - 58mV output from coil
   - 30 turns around straw
   - Straw
     - 5.3mm diameter
     - 
   - ??T field strength
     - Can calculate
     - Measure with hall effect sensor
